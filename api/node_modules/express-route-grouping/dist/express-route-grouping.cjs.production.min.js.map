{"version":3,"file":"express-route-grouping.cjs.production.min.js","sources":["../src/resources.ts","../src/index.ts"],"sourcesContent":["const RESOURCES = {\n  index: { method: 'get', suffix: false },\n  find: { method: 'get', suffix: true },\n  create: { method: 'post', suffix: false },\n  update: { method: 'put', suffix: true },\n  patch: { method: 'patch', suffix: true },\n  delete: { method: 'delete', suffix: true },\n} as Record<string, Record<string, any>>;\n\nexport default RESOURCES;\n","import { IRouter as IExpressRouter, Router } from 'express';\nimport pluralize from 'pluralize';\nimport { RequestMethods, ResourceOptions, Resources } from './types';\nimport RESOURCES from './resources';\n\ntype GroupCallback = (router: IRouter) => void;\n\ntype IRouter = IExpressRouter & {\n  group: (path: string, fn: GroupCallback) => void;\n  resource: (options: ResourceOptions) => void;\n  export: () => IExpressRouter;\n  to: (suffix: string) => string;\n};\n\nclass RouteGroup {\n  private head: string;\n  private router: IExpressRouter;\n  private proxyRouter?: IRouter;\n\n  constructor(path: string = '/', router: IExpressRouter = Router()) {\n    this.head = path;\n    this.router = router;\n  }\n\n  public group = (path: string = '', fn: GroupCallback): void => {\n    const newGroup = new RouteGroup(\n      this.head + this.sanitize(path),\n      this.router\n    );\n    this.proxyRouter = this.createProxy(this.router, newGroup);\n    fn(this.proxyRouter);\n  };\n\n  public resource = (options: ResourceOptions) => {\n    if (!options) {\n      throw new Error('Resource handlers are required!');\n    }\n\n    const { handlers = {}, beforeHandlers = [], afterHandlers = [] } = options;\n\n    Object.keys(RESOURCES).forEach((name: string) => {\n      const { method, suffix } = RESOURCES[name];\n      const requestRouter = this.router[method as RequestMethods];\n\n      const fullPath = this.to(suffix ? this.getPlaceholder() : '/');\n      const handler = handlers[name as Resources] as any;\n\n      if (handler) {\n        requestRouter.bind(this.router)(\n          fullPath,\n          ...beforeHandlers,\n          ...(Array.isArray(handler) ? handler : [handler]),\n          ...afterHandlers\n        );\n      }\n    });\n  };\n\n  public export = () => this.router;\n\n  public to = (suffix: string = '/'): string => {\n    return this.head + this.sanitize(suffix);\n  };\n\n  private sanitize(path: string): string {\n    if (path === '/') return '';\n\n    // remove slashes at start and end positions, if exists\n    // to sure there is no any slashes.\n    let newPath = path.replace(/^(\\/+)(.)/, '$2').replace(/(.)(\\/+)$/, '$1');\n\n    // add delimiter on the end\n    if (this.head !== '/') {\n      newPath = newPath.padStart(newPath.length + 1, '/');\n    }\n\n    return newPath;\n  }\n\n  private toCamelCase(str: string): string {\n    if (str === '') {\n      return str;\n    }\n\n    const word = str\n      .replace(/[^A-Za-z0-9]/g, ' ') // transfrom non-alphanumeric chars to space\n      .replace(/\\s+/g, ' ') // trim multiple space\n      .split(/[-_\\s]/)\n      .map(f => f[0].toLocaleUpperCase() + f.substr(1))\n      .join('');\n\n    return word[0].toLocaleLowerCase() + word.substr(1);\n  }\n\n  private callRouter(value: Function | RequestMethods) {\n    return typeof value === 'function'\n      ? (path: string, ...handlers: CallableFunction[]) => {\n          value.call(this.router, this.to(path), ...handlers);\n        }\n      : this.router[value];\n  }\n\n  private getPlaceholder() {\n    const namespace = this.head.split('/').pop() || '';\n    const prefix = pluralize.singular(this.toCamelCase(namespace));\n    return `:${prefix ? `${prefix}Id` : 'id'}`;\n  }\n\n  private createProxy(router: IExpressRouter, newGroup: RouteGroup) {\n    const self = newGroup as any;\n    const callRouter = this.callRouter.bind(newGroup);\n    const handler = {\n      get: function(_: any, prop: any) {\n        return self[prop]\n          ? Reflect.get(self, prop)\n          : callRouter(router[prop as RequestMethods]);\n      },\n    };\n\n    return new Proxy<IRouter>(this as any, handler);\n  }\n}\n\nexport default RouteGroup;\n"],"names":["RESOURCES","index","method","suffix","find","create","update","patch","delete","RouteGroup","path","router","Router","this","fn","newGroup","_this","head","sanitize","proxyRouter","createProxy","options","Error","_options$handlers","handlers","_options$beforeHandle","beforeHandlers","_options$afterHandler","afterHandlers","Object","keys","forEach","name","_RESOURCES$name","requestRouter","fullPath","to","getPlaceholder","handler","bind","apply","concat","Array","isArray","_proto","prototype","newPath","replace","padStart","length","toCamelCase","str","word","split","map","f","toLocaleUpperCase","substr","join","toLocaleLowerCase","callRouter","value","_len","_key","arguments","call","_this2","namespace","pop","prefix","pluralize","singular","self","Proxy","get","_","prop","Reflect"],"mappings":"yKAAMA,EAAY,CAChBC,MAAO,CAAEC,OAAQ,MAAOC,QAAQ,GAChCC,KAAM,CAAEF,OAAQ,MAAOC,QAAQ,GAC/BE,OAAQ,CAAEH,OAAQ,OAAQC,QAAQ,GAClCG,OAAQ,CAAEJ,OAAQ,MAAOC,QAAQ,GACjCI,MAAO,CAAEL,OAAQ,QAASC,QAAQ,GAClCK,OAAQ,CAAEN,OAAQ,SAAUC,QAAQ,+BCapC,SAAAM,EAAYC,EAAoBC,uBAApBD,IAAAA,EAAe,cAAKC,IAAAA,EAAyBC,YAKlDC,WAAQ,SAACH,EAAmBI,YAAnBJ,IAAAA,EAAe,IAC7B,IAAMK,EAAW,IAAIN,EACnBO,EAAKC,KAAOD,EAAKE,SAASR,GAC1BM,EAAKL,QAEPK,EAAKG,YAAcH,EAAKI,YAAYJ,EAAKL,OAAQI,GACjDD,EAAGE,EAAKG,cAGHN,cAAW,SAACQ,GACjB,IAAKA,EACH,MAAM,IAAIC,MAAM,mCAGlB,IAAAC,EAAmEF,EAA3DG,SAAAA,WAAQD,EAAG,GAAEA,EAAAE,EAA8CJ,EAA5CK,eAAAA,WAAcD,EAAG,GAAEA,EAAAE,EAAyBN,EAAvBO,cAAAA,WAAaD,EAAG,GAAEA,EAE9DE,OAAOC,KAAK9B,GAAW+B,SAAQ,SAACC,GAC9B,IAAAC,EAA2BjC,EAAUgC,GAC/BE,EAAgBlB,EAAKL,OADbsB,EAAN/B,QAGFiC,EAAWnB,EAAKoB,GAHAH,EAAN9B,OAGkBa,EAAKqB,iBAAmB,KACpDC,EAAUd,EAASQ,GAErBM,GACFJ,EAAcK,KAAKvB,EAAKL,QAAO6B,cAC7BL,GAAQM,OACLf,EACCgB,MAAMC,QAAQL,GAAWA,EAAU,CAACA,GACrCV,QAMJf,YAAS,WAAA,OAAMG,EAAKL,QAEpBE,QAAK,SAACV,GACX,gBADWA,IAAAA,EAAiB,KACrBa,EAAKC,KAAOD,EAAKE,SAASf,IAzCjCU,KAAKI,KAAOP,EACZG,KAAKF,OAASA,EACf,IAAAiC,EAAAnC,EAAAoC,UAkGA,OAlGAD,EA0CO1B,SAAA,SAASR,GACf,GAAa,MAATA,EAAc,MAAO,GAIzB,IAAIoC,EAAUpC,EAAKqC,QAAQ,YAAa,MAAMA,QAAQ,YAAa,MAOnE,MAJkB,MAAdlC,KAAKI,OACP6B,EAAUA,EAAQE,SAASF,EAAQG,OAAS,EAAG,MAG1CH,GACRF,EAEOM,YAAA,SAAYC,GAClB,GAAY,KAARA,EACF,OAAOA,EAGT,IAAMC,EAAOD,EACVJ,QAAQ,gBAAiB,KACzBA,QAAQ,OAAQ,KAChBM,MAAM,UACNC,KAAI,SAAAC,GAAC,OAAIA,EAAE,GAAGC,oBAAsBD,EAAEE,OAAO,MAC7CC,KAAK,IAER,OAAON,EAAK,GAAGO,oBAAsBP,EAAKK,OAAO,IAClDb,EAEOgB,WAAA,SAAWC,cACjB,MAAwB,mBAAVA,EACV,SAACnD,8BAAiBc,MAA4BkB,MAAAoB,IAAAA,OAAAC,IAAAA,EAAAD,EAAAC,IAA5BvC,EAA4BuC,KAAAC,UAAAD,GAC5CF,EAAMI,KAAIzB,MAAVqB,GAAWK,EAAKvD,OAAQuD,EAAK9B,GAAG1B,IAAK+B,OAAKjB,KAE5CX,KAAKF,OAAOkD,IACjBjB,EAEOP,eAAA,WACN,IAAM8B,EAAYtD,KAAKI,KAAKoC,MAAM,KAAKe,OAAS,GAC1CC,EAASC,EAAUC,SAAS1D,KAAKqC,YAAYiB,IACnD,WAAWE,EAAYA,OAAa,OACrCzB,EAEOxB,YAAA,SAAYT,EAAwBI,GAC1C,IAAMyD,EAAOzD,EACP6C,EAAa/C,KAAK+C,WAAWrB,KAAKxB,GASxC,OAAO,IAAI0D,MAAe5D,KARV,CACd6D,IAAK,SAASC,EAAQC,GACpB,OAAOJ,EAAKI,GACRC,QAAQH,IAAIF,EAAMI,GAClBhB,EAAWjD,EAAOiE,QAK3BnE"}