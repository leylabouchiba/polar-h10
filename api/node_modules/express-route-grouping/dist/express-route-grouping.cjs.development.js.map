{"version":3,"file":"express-route-grouping.cjs.development.js","sources":["../src/resources.ts","../src/index.ts"],"sourcesContent":["const RESOURCES = {\n  index: { method: 'get', suffix: false },\n  find: { method: 'get', suffix: true },\n  create: { method: 'post', suffix: false },\n  update: { method: 'put', suffix: true },\n  patch: { method: 'patch', suffix: true },\n  delete: { method: 'delete', suffix: true },\n} as Record<string, Record<string, any>>;\n\nexport default RESOURCES;\n","import { IRouter as IExpressRouter, Router } from 'express';\nimport pluralize from 'pluralize';\nimport { RequestMethods, ResourceOptions, Resources } from './types';\nimport RESOURCES from './resources';\n\ntype GroupCallback = (router: IRouter) => void;\n\ntype IRouter = IExpressRouter & {\n  group: (path: string, fn: GroupCallback) => void;\n  resource: (options: ResourceOptions) => void;\n  export: () => IExpressRouter;\n  to: (suffix: string) => string;\n};\n\nclass RouteGroup {\n  private head: string;\n  private router: IExpressRouter;\n  private proxyRouter?: IRouter;\n\n  constructor(path: string = '/', router: IExpressRouter = Router()) {\n    this.head = path;\n    this.router = router;\n  }\n\n  public group = (path: string = '', fn: GroupCallback): void => {\n    const newGroup = new RouteGroup(\n      this.head + this.sanitize(path),\n      this.router\n    );\n    this.proxyRouter = this.createProxy(this.router, newGroup);\n    fn(this.proxyRouter);\n  };\n\n  public resource = (options: ResourceOptions) => {\n    if (!options) {\n      throw new Error('Resource handlers are required!');\n    }\n\n    const { handlers = {}, beforeHandlers = [], afterHandlers = [] } = options;\n\n    Object.keys(RESOURCES).forEach((name: string) => {\n      const { method, suffix } = RESOURCES[name];\n      const requestRouter = this.router[method as RequestMethods];\n\n      const fullPath = this.to(suffix ? this.getPlaceholder() : '/');\n      const handler = handlers[name as Resources] as any;\n\n      if (handler) {\n        requestRouter.bind(this.router)(\n          fullPath,\n          ...beforeHandlers,\n          ...(Array.isArray(handler) ? handler : [handler]),\n          ...afterHandlers\n        );\n      }\n    });\n  };\n\n  public export = () => this.router;\n\n  public to = (suffix: string = '/'): string => {\n    return this.head + this.sanitize(suffix);\n  };\n\n  private sanitize(path: string): string {\n    if (path === '/') return '';\n\n    // remove slashes at start and end positions, if exists\n    // to sure there is no any slashes.\n    let newPath = path.replace(/^(\\/+)(.)/, '$2').replace(/(.)(\\/+)$/, '$1');\n\n    // add delimiter on the end\n    if (this.head !== '/') {\n      newPath = newPath.padStart(newPath.length + 1, '/');\n    }\n\n    return newPath;\n  }\n\n  private toCamelCase(str: string): string {\n    if (str === '') {\n      return str;\n    }\n\n    const word = str\n      .replace(/[^A-Za-z0-9]/g, ' ') // transfrom non-alphanumeric chars to space\n      .replace(/\\s+/g, ' ') // trim multiple space\n      .split(/[-_\\s]/)\n      .map(f => f[0].toLocaleUpperCase() + f.substr(1))\n      .join('');\n\n    return word[0].toLocaleLowerCase() + word.substr(1);\n  }\n\n  private callRouter(value: Function | RequestMethods) {\n    return typeof value === 'function'\n      ? (path: string, ...handlers: CallableFunction[]) => {\n          value.call(this.router, this.to(path), ...handlers);\n        }\n      : this.router[value];\n  }\n\n  private getPlaceholder() {\n    const namespace = this.head.split('/').pop() || '';\n    const prefix = pluralize.singular(this.toCamelCase(namespace));\n    return `:${prefix ? `${prefix}Id` : 'id'}`;\n  }\n\n  private createProxy(router: IExpressRouter, newGroup: RouteGroup) {\n    const self = newGroup as any;\n    const callRouter = this.callRouter.bind(newGroup);\n    const handler = {\n      get: function(_: any, prop: any) {\n        return self[prop]\n          ? Reflect.get(self, prop)\n          : callRouter(router[prop as RequestMethods]);\n      },\n    };\n\n    return new Proxy<IRouter>(this as any, handler);\n  }\n}\n\nexport default RouteGroup;\n"],"names":["RESOURCES","index","method","suffix","find","create","update","patch","RouteGroup","path","router","Router","fn","newGroup","_this","head","sanitize","proxyRouter","createProxy","options","Error","_options$handlers","handlers","_options$beforeHandle","beforeHandlers","_options$afterHandler","afterHandlers","Object","keys","forEach","name","_RESOURCES$name","requestRouter","fullPath","to","getPlaceholder","handler","bind","apply","concat","Array","isArray","_proto","prototype","newPath","replace","padStart","length","toCamelCase","str","word","split","map","f","toLocaleUpperCase","substr","join","toLocaleLowerCase","callRouter","value","_len","_key","arguments","call","_this2","namespace","pop","prefix","pluralize","singular","self","get","_","prop","Reflect","Proxy"],"mappings":"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"}